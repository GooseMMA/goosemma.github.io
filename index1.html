<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Бильярд</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #2f2f2f;
    }
    canvas {
      border: 5px solid #1a1a1a;
      background-color: #4e8b3f;
    }
  </style>
</head>
<body>

<canvas id="billiards"></canvas>

<script>
// Настройки холста и игры
const canvas = document.getElementById('billiards');
const ctx = canvas.getContext('2d');

// Получаем размер экрана
const tableWidth = window.innerWidth * 0.9;  // 90% ширины экрана
const tableHeight = window.innerHeight * 0.8;  // 80% высоты экрана

canvas.width = tableWidth;
canvas.height = tableHeight;

// Константы для игры
const ballRadius = 10;
const friction = 0.99;
const cushionBounce = 0.8; // Отражение от бортиков

// Мячи на столе
let balls = [
  { x: tableWidth / 4, y: tableHeight / 2, dx: 0, dy: 0, color: "white", moving: false }
];

// Для отрисовки траектории удара
let isAiming = false;
let aimLine = { x1: tableWidth / 4, y1: tableHeight / 2, x2: tableWidth / 4, y2: tableHeight / 2 };

function drawTable() {
  ctx.fillStyle = '#4e8b3f';
  ctx.fillRect(0, 0, tableWidth, tableHeight);

  ctx.strokeStyle = '#333';
  ctx.lineWidth = 10;
  ctx.strokeRect(0, 0, tableWidth, tableHeight);
}

function drawBall(ball) {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
  ctx.fillStyle = ball.color;
  ctx.fill();
  ctx.strokeStyle = 'black';
  ctx.stroke();
}

function drawCueLine() {
  if (isAiming) {
    ctx.beginPath();
    ctx.moveTo(aimLine.x1, aimLine.y1);
    ctx.lineTo(aimLine.x2, aimLine.y2);
    ctx.strokeStyle = 'yellow';
    ctx.lineWidth = 2;
    ctx.stroke();
  }
}

function updateBall(ball) {
  ball.x += ball.dx;
  ball.y += ball.dy;

  // Отражение от стенок
  if (ball.x - ballRadius < 0 || ball.x + ballRadius > tableWidth) {
    ball.dx = -ball.dx * cushionBounce;
  }
  if (ball.y - ballRadius < 0 || ball.y + ballRadius > tableHeight) {
    ball.dy = -ball.dy * cushionBounce;
  }

  // Трение
  if (Math.abs(ball.dx) < 0.1) ball.dx = 0;
  if (Math.abs(ball.dy) < 0.1) ball.dy = 0;

  ball.dx *= friction;
  ball.dy *= friction;
}

function update() {
  // Обновляем все мячи
  balls.forEach(ball => {
    if (ball.moving) {
      updateBall(ball);
    }
  });

  // Отрисовка
  drawTable();
  balls.forEach(ball => drawBall(ball));
  drawCueLine();

  requestAnimationFrame(update);
}

function shootBall() {
  if (!balls[0].moving) {
    balls[0].dx = (aimLine.x2 - aimLine.x1) / 10;
    balls[0].dy = (aimLine.y2 - aimLine.y1) / 10;
    balls[0].moving = true;
  }
}

// Обработчик движения мыши на десктопе
function handleMouseMove(event) {
  const mouseX = event.offsetX;
  const mouseY = event.offsetY;

  if (mouseX >= 0 && mouseX <= tableWidth && mouseY >= 0 && mouseY <= tableHeight) {
    isAiming = true;
    aimLine.x2 = mouseX;
    aimLine.y2 = mouseY;
  }
}

// Обработчик сенсорного ввода на мобильных устройствах
function handleTouchMove(event) {
  const touch = event.touches[0];
  const touchX = touch.clientX;
  const touchY = touch.clientY;

  if (touchX >= 0 && touchX <= tableWidth && touchY >= 0 && touchY <= tableHeight) {
    isAiming = true;
    aimLine.x2 = touchX;
    aimLine.y2 = touchY;
  }
}

function handleTouchStart(event) {
  shootBall();
}

function handleClick(event) {
  shootBall();
}

// Добавляем обработчики событий для мобильных и десктопных устройств
if ('ontouchstart' in window) {
  canvas.addEventListener('touchmove', handleTouchMove);
  canvas.addEventListener('touchstart', handleTouchStart);
} else {
  canvas.addEventListener('mousemove', handleMouseMove);
  canvas.addEventListener('click', handleClick);
}

update();
</script>

</body>
</html>