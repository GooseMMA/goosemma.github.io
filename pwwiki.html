<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OGPS Pixel Worlds Wiki</title>
<style>
  :root {
    --bg: #0b111c;
    --panel: #101a2e;
    --text: #e8f2ff;
    --muted: #9aaac5;
    --accent: #28d1ff;
    --accent2: #9b5cff;
  }
  * {box-sizing:border-box;}
  body {
    margin:0; font-family: "Segoe UI", system-ui;
    background: var(--bg); color: var(--text);
    height:100vh; display:flex; flex-direction:column;
    overflow:hidden;
  }
  header {
    display:flex; align-items:center; padding:10px 16px;
    background:var(--panel); gap:10px; border-bottom:1px solid rgba(255,255,255,0.1);
  }
  input {
    flex:1; background:#13213c; border:none; border-radius:6px;
    padding:10px 12px; color:var(--text); font-size:15px;
  }
  button {
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    border:none; border-radius:6px; color:#000;
    font-weight:bold; padding:8px 14px; cursor:pointer;
  }
  main {flex:1; display:grid; grid-template-columns:250px 1fr 350px;}
  #list {background:var(--panel); overflow-y:auto; padding:10px;}
  #list div {
    display:flex; align-items:center; gap:10px;
    padding:6px; border-radius:8px; cursor:pointer;
    transition:background 0.2s, transform 0.2s;
  }
  #list div:hover {background:rgba(255,255,255,0.07); transform:translateX(3px);}
  #list img {width:32px; height:32px; image-rendering:pixelated;}
  #details {padding:20px; overflow:auto;}
  #details img {width:72px; height:72px; image-rendering:pixelated;}
  h2 {color:var(--accent);}
  .field {margin:6px 0; color:var(--muted);}
  .field strong {color:var(--text);}
  .craft {display:flex; flex-wrap:wrap; gap:6px;}
  .craft button {
    background:rgba(255,255,255,0.08); border:none;
    color:var(--text); border-radius:6px; padding:4px 8px; font-size:14px;
  }
  #tree {position:relative; background:#0c1525; border-left:1px solid rgba(255,255,255,0.1);}
  #tree canvas {width:100%; height:100%; background:#0c1525; cursor:grab;}
  #tree canvas:active {cursor:grabbing;}
  @media(max-width:900px){
    main{grid-template-columns:1fr;}
    #tree{display:none;}
  }
</style>
</head>
<body>
<header>
  <input id="search" placeholder="Search items...">
  <button id="toggleTree">Show Tree</button>
</header>

<main>
  <aside id="list"></aside>
  <section id="details"><h2>Welcome</h2><p>Select an item to view details.</p></section>
  <section id="tree"><canvas id="treeCanvas"></canvas></section>
</main>

<script>
// === GLOBAL ===
let ITEMS = JSON.parse(localStorage.getItem('PIXEL_ITEMS') || '[]');
let ITEM_MAP = {};
const list = document.getElementById('list');
const details = document.getElementById('details');
const search = document.getElementById('search');
const canvas = document.getElementById('treeCanvas');
const ctx = canvas.getContext('2d');
let width, height;
let nodes = [], links = [];
let offsetX=0, offsetY=0, scale=1;
let drag=false, startX=0, startY=0;

// === INIT ===
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

if(ITEMS.length===0){
  fetch('items.json').then(r=>r.json()).then(d=>{
    ITEMS=d; localStorage.setItem('PIXEL_ITEMS',JSON.stringify(d));
    buildMap(); renderList();
  });
}else{
  buildMap(); renderList();
}

function buildMap(){ITEMS.forEach(i=>ITEM_MAP[i.name]=i);}

// === UI ===
function renderList(filter=''){
  list.innerHTML='';
  let f=filter.toLowerCase();
  ITEMS.filter(i=>i.name.toLowerCase().includes(f)).forEach(i=>{
    let d=document.createElement('div');
    d.innerHTML=`<img src="${i.image}"><span>${i.name}</span>`;
    d.onclick=()=>showItem(i.name);
    list.appendChild(d);
  });
}

search.oninput=()=>renderList(search.value);

function showItem(name){
  const i=ITEM_MAP[name]; if(!i)return;
  let html=`<img src="${i.image}"><h2>${i.name}</h2>`;
  html+=`<div class="field"><strong>Complexity:</strong> ${i.complexity??'N/A'}</div>`;
  html+=`<div class="field"><strong>Tier:</strong> ${i.tier??'N/A'}</div>`;
  html+=`<div class="field"><strong>Rarity:</strong> ${i.rarity??'N/A'}</div>`;
  html+=`<div class="field"><strong>Farmability:</strong> ${i.farmability??'N/A'}</div>`;
  html+=`<div class="field"><strong>Growth Time:</strong> ${i.growthTime??'N/A'}</div>`;
  if(i.craftable && i.craft.length){
    html+=`<div class="field"><strong>Craft:</strong></div><div class="craft">`;
    i.craft.forEach(c=>{ html+=`<button onclick="showItem('${c}')">${c}</button>`;});
    html+=`</div>`;
  }
  details.innerHTML=html;
  drawTreeForItem(i);
}

// === TREE ===
function resizeCanvas(){
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
  width=canvas.width; height=canvas.height;
  drawTree();
}

function drawTreeForItem(item){
  // build tree graph
  nodes=[]; links=[];
  const visited=new Set();
  function traverse(name,depth=0,x=0,y=0){
    if(visited.has(name)) return;
    visited.add(name);
    const i=ITEM_MAP[name]; if(!i || !i.craftable) return;
    nodes.push({name,x:depth,y});
    i.craft.forEach((c,j)=>{
      links.push({from:c,to:name});
      traverse(c,depth+1,y+j);
    });
  }
  traverse(item.name);
  drawTree();
}

function drawTree(){
  ctx.clearRect(0,0,width,height);
  ctx.save();
  ctx.translate(offsetX,offsetY);
  ctx.scale(scale,scale);
  ctx.lineWidth=2;
  ctx.strokeStyle='rgba(255,255,255,0.2)';
  for(let l of links){
    const a=nodes.find(n=>n.name===l.from);
    const b=nodes.find(n=>n.name===l.to);
    if(a&&b){
      ctx.beginPath();
      ctx.moveTo(a.x*160+60,a.y*80+60);
      ctx.lineTo(b.x*160+60,b.y*80+60);
      ctx.stroke();
    }
  }
  for(let n of nodes){
    const i=ITEM_MAP[n.name];
    if(!i) continue;
    const x=n.x*160+40, y=n.y*80+40;
    ctx.fillStyle='rgba(255,255,255,0.07)';
    ctx.fillRect(x,y,100,80);
    const img=new Image();
    img.src=i.image;
    img.onload=()=>ctx.drawImage(img,x+24,y+8,48,48);
    ctx.fillStyle='#fff';
    ctx.font='12px Segoe UI';
    ctx.fillText(i.name.slice(0,14),x+10,y+70);
  }
  ctx.restore();
}

// === INTERACTION ===
canvas.addEventListener('mousedown',e=>{
  drag=true; startX=e.clientX; startY=e.clientY;
});
canvas.addEventListener('mouseup',()=>drag=false);
canvas.addEventListener('mousemove',e=>{
  if(!drag)return;
  offsetX+=e.movementX;
  offsetY+=e.movementY;
  drawTree();
});
canvas.addEventListener('wheel',e=>{
  e.preventDefault();
  const delta=e.deltaY>0?0.9:1.1;
  scale*=delta;
  drawTree();
});

</script>
</body>
</html>